---
title: "Zero-modified Poisson distribution"
author: "Marcelo Ventura Freire"
format: 
  # pdf
  html:
    embed-resources: true
    toc: true
    toc-depth: 3
    number-sections: true
execute: 
  echo: false
  cache: true
---

```{r}
#| label: setup
#| include: false

library(tidyverse)  # my go-to package
library(actuar)     # dzmpois() 
library(latex2exp)  # TeX()
library(patchwork)

`%$%` <- paste0  # concatenação de string
```



## Introduction

I did not invented this model, but I will give the proper credits later, when I write a proper introduction.

### Literature review

Soon...

### Examples of applications

TO-DO: examples of phenomena with occurrences of over- and under-occurrences of zero observations.



## Definitions

From the (regular) Poisson distribution $X \sim Poi(\lambda)$ with $\lambda\in(0,\infty)$ and $x=0,1,2,\ldots$
$$
P(X=x) = \frac{e^{-\lambda}\lambda^x}{x!}
$$
and $p_0=P(X=0)=e^{-\lambda}$, we define:

- the *truncated* Poisson distribution $Y \sim TruncPoi(\lambda)$, with 
  $\lambda\in(0,\infty)$
  $$
  P(Y=y) 
    = P(X=y|X>0) 
    = \frac{P(X=y)}{1-P(X=0)}
    % = \frac{\frac{e^{-\lambda}\lambda^y}{y!}}{(1-e^{-\lambda})}
    = \frac{\lambda^y}{(e^\lambda-1)y!},
  $$
  for $y=1,2,\ldots$
- the *zero-inflated* Poisson distribution $Z \sim ZInflPoi(\pi, \lambda)$, 
  with $\pi\in(0,1)$ and $\lambda\in(0,\infty)$
  $$
  P(Z=z) =
    \begin{cases}
    \pi + (1-\pi) \cdot P(X=0) 
      = \pi + (1-\pi)e^{-\lambda}
      & z=0\\
    (1-\pi) P(X=z) 
      = \frac{(1-\pi)e^{-\lambda}\lambda^z}{z!},
      & z=1,2,\ldots
    \end{cases}
  $$
  which can be thought of as a mixture model as 
  $Z = I \times 0 + (1 - I) \times X$
  where $I \sim Bern(\pi)$ independent of $X$.
- the (general) *zero-modified* Poisson distribution
  $W \sim ZModPoi(p, \lambda)$, with $p\in(0,1)$ and $\lambda>0$
  $$
  P(W=w) =
    \begin{cases}
    p & w=0\\
    (1-p) \cdot P(Y=w) 
      = \frac{(1-p)\lambda^w}{(e^\lambda-1)w!},
      & w=1,2,\ldots
    \end{cases}
  $$
  which can be thought of as a hurdle model as 
  $W = J \times 0 + (1 - J) \times Y$
  where $J \sim Bern(p)$ independent of $Y$.


Note that the regular, the zero-inflated, the zero-deflated, and the truncated Poisson distributions can be obtained from the general model respectively when $p=p_0$, $p>p_0$, $p<p_0$, and $p\to0$.

```{r}
#| label: graph-1st-param
#| fig-cap: "Visualizing difference among distrubions"

xfinal <- 6
expand_grid(
  x = 0:xfinal,
  lambda = c(0.5, 1, 2, 3)
) |> 
  mutate(
    RegPoi =  
      dzmpois(x, lambda, dpois(0, lambda)),
    TruncPoi =
      dzmpois(x, lambda, 0),
    ZDeflPoi = 
      dzmpois(x, lambda, 0.5 * dpois(0, lambda)),
    ZInfPoi = 
      dzmpois(x, lambda, 1.5 * dpois(0, lambda)),
  ) |> 
  pivot_longer(
    cols = RegPoi:ZInfPoi,
    values_to = "y",
    names_to = "distrib",
  ) |> 
  ggplot() +
  aes(x = x, y = y, group = distrib, color = distrib) +
  geom_point() +
  geom_line() +
  scale_x_continuous(
    breaks = 0:xfinal,
    labels = scales::label_number(accuracy = 1)
  ) +
  facet_wrap(~ lambda, labeller = "label_both") +
  ggtitle( 
    "Comparing regular, truncated, zero-deflated, " %$%
      "and zero-inflated Poisson distributions"
  ) +
  xlab("z") +
  ylab("P(Z=z)") +
  theme_classic()
```


A second parametrization for the zero-modified Poisson distribution can be obtained by setting $p=e^{-\lambda+\theta}$, so that, for $Z \sim ZModPoi(\theta, \lambda)$, we have
$$
P(W=w) = 
\begin{cases}
e^{-\lambda+\theta}, 
  & w=0\\
\frac{(1-e^{-\lambda+\theta})\lambda^w}{(e^{\lambda}-1)w!}
  & w=1,2,\ldots
\end{cases}
$$
in which case, regular, zero-inflated, and zero-deflated Poisson can be obtained when $\theta=0$, $\theta>0$, and $\theta<0$. However, a constraint must be set on $\theta$ so that $0<p<1$:
$$
e^{-\lambda+\theta}<1
  \Leftrightarrow
    -\lambda+\theta<0
  \Leftrightarrow
    \theta<\lambda.
$$
This way, we can refer to $Z \sim ZModPoi(\theta,\lambda)$ for $\lambda>0$ and $\theta<\lambda$ as the model in its second parametrization.


For algebraic ease, we may use a third parametrization setting $1-p=e^\gamma$, subject to $0<e^\gamma<1 \Leftrightarrow \gamma<0$, 
$$
P(W=w) = 
\begin{cases}
1-e^{\gamma}, 
  & y=0\\
\frac{e^\gamma\lambda^w}{(e^{\lambda}-1)w!}
  & w=1,2,\ldots
\end{cases}
$$
so that the parametrization used in each context will be defined by the use of the three different parameters.



## Likelihood and ML estimation

For a single observation, we have
$$
\ell(p,\lambda) =
\begin{cases}
\log(p) 
  & z=0 \\
\log\left(\frac{(1-p)\lambda^y}{(e^\lambda-1)y!}\right)
  = \log(1-p)+\log(\lambda^y)-\log(e^\lambda-1)-\log(y!))
  & z=1,2,\ldots
\end{cases}
$$
and, for an i.i.d. sample $Z_1,Z_2,\ldots,X_n$ of $ZModPoi(p, \lambda)$, we have, 
$$
\begin{align}
L(p,\lambda)
  & = P(Z_1=z_1,\ldots,Z_n=z_n) \\
  & = \prod_{i=1}^n P(Z=z_i) \\
  & = \prod_{i \in M} P(Z=z_i) \times
      \prod_{i \not\in M} P(Z=z_i) \\
  & = \prod_{i \in M} P(Z=0) \times
      \prod_{i \not\in M} P(Z=z_i) \\
  & = \prod_{i \in M} e^{-\lambda} \times
      \prod_{i \not\in M} P(Z=z_i) \\
\end{align}
$$
where $M$ is the set $M=\{i=1,2,\ldots,n; z_i=0\}$ of positions of the observed zeroes and $m=#M$ is its size.


